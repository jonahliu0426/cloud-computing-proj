{"ast":null,"code":"var _jsxFileName = \"/Users/jia78/Desktop/nyu-mscs/9223-cloud-computing/cloud-computing-proj/cloud-computing-proj/src/pages/login.js\";\nimport { Button, Card, CardHeader, TextField, Typography, InputAdornment } from \"@material-ui/core\";\nimport React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport SEO from \"../components/shared/Seo\";\nimport { useLoginPageStyles } from \"../styles\";\nimport FacebookIconBlue from \"../images/facebook-icon-blue.svg\";\nimport FacebookIconWhite from \"../images/facebook-icon-white.png\";\nimport { useForm, Controller } from \"react-hook-form\";\nimport { AuthContext } from \"../auth\";\nimport { useHistory } from 'react-router-dom';\nimport isEmail from \"validator/lib/isEmail\";\nimport { useApolloClient } from \"@apollo/client\";\nimport { GET_USER_EMAIL } from \"../graphql/queries\";\nimport { AuthError } from './signup';\n\nconst LoginPage = () => {\n  const {\n    handleSubmit,\n    watch,\n    formState,\n    control\n  } = useForm({\n    mode: \"onChange\"\n  });\n  const {\n    isValid,\n    isSubmitting\n  } = formState;\n  const classes = useLoginPageStyles();\n  const [showPassword, setShowPassword] = React.useState(false);\n  const hasPassword = Boolean(watch(\"password\"));\n  const {\n    logInWithEmailAndPassword\n  } = React.useContext(AuthContext);\n  const history = useHistory();\n  const client = useApolloClient();\n  const [error, setError] = React.useState('');\n  console.log();\n\n  const handleClickShowPassword = event => {\n    setShowPassword(prev => !prev);\n  };\n\n  async function getUserEmail(input) {\n    var _response$data$users$;\n\n    const variables = {\n      input\n    };\n    console.log(variables);\n    const response = await client.query({\n      query: GET_USER_EMAIL,\n      variables\n    });\n    const userEmail = ((_response$data$users$ = response.data.users[0]) === null || _response$data$users$ === void 0 ? void 0 : _response$data$users$.email) || \"no@email.com\";\n    console.log('user email', userEmail);\n    return userEmail;\n  }\n\n  const handleError = error => {\n    if (error.code.includes(\"auth\")) {\n      setError(error.message);\n    }\n  };\n\n  async function onSubmit({\n    input,\n    password\n  }) {\n    try {\n      setError(\"\");\n\n      if (!isEmail(input)) {\n        input = await getUserEmail(input);\n      }\n\n      console.log({\n        input,\n        password\n      });\n      await logInWithEmailAndPassword(input, password);\n      setTimeout(() => history.push(\"/\"), 0);\n    } catch (error) {\n      console.error(\"Error logging in\", error);\n      handleError(error);\n    }\n  } // const handleMouseDownPassword = () => setShowPassword(!showPassword)\n\n\n  return React.createElement(React.Fragment, null, React.createElement(SEO, {\n    title: \"Login\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  }), React.createElement(\"section\", {\n    className: classes.section,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }, React.createElement(\"article\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78\n    },\n    __self: this\n  }, React.createElement(Card, {\n    className: classes.card,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79\n    },\n    __self: this\n  }, React.createElement(CardHeader, {\n    className: classes.cardHeader,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80\n    },\n    __self: this\n  }), React.createElement(\"form\", {\n    onSubmit: handleSubmit(onSubmit),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, React.createElement(Controller, {\n    name: \"input\",\n    control: control,\n    defaultValue: \"\",\n    render: ({\n      field: {\n        onChange,\n        value\n      },\n      fieldState: {\n        error\n      }\n    }) => React.createElement(TextField // {...register('input', { 'required': true, minLength: 5 })}\n    , {\n      fullWidth: true,\n      variant: \"filled\",\n      label: \"Username, email or phone\",\n      margin: \"dense\",\n      className: classes.textField // autoComplete=\"username\"\n      ,\n      error: !!error,\n      value: value,\n      onChange: onChange,\n      helperText: error ? error.message : null,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }),\n    rules: {\n      'required': true,\n      minLength: 5\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }), React.createElement(Controller, {\n    name: \"password\",\n    control: control,\n    defaultValue: \"\",\n    render: ({\n      field: {\n        onChange,\n        value\n      },\n      fieldState: {\n        error\n      }\n    }) => React.createElement(TextField // {...register('password', { 'required': true, minLength: 6 })}\n    , {\n      fullWidth: true,\n      variant: \"filled\",\n      label: \"password\",\n      type: showPassword ? \"text\" : \"password\",\n      margin: \"dense\",\n      className: classes.textField // autoComplete=\"current-password\"\n      ,\n      value: value,\n      onChange: onChange,\n      error: !!error,\n      helperText: error ? error.message : null,\n      InputProps: {\n        endAdornment: hasPassword && React.createElement(InputAdornment, {\n          position: \"end\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 123\n          },\n          __self: this\n        }, React.createElement(Button, {\n          variant: \"contained\",\n          fullWidth: true,\n          className: classes.adornedEndButton,\n          onClick: handleClickShowPassword,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 124\n          },\n          __self: this\n        }, showPassword ? \"Hide\" : \"Show\")),\n        classes: {\n          adornedEnd: classes.adornedEnd\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }),\n    rules: {\n      'required': true,\n      minLength: 6\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }), React.createElement(Button, {\n    disabled: !isValid || isSubmitting,\n    variant: \"contained\",\n    fullWidth: true,\n    color: \"primary\",\n    className: classes.button,\n    type: \"submit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, \"Log In\")), React.createElement(\"div\", {\n    className: classes.orContainer,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: classes.orLine,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(Typography, {\n    variant: \"body2\",\n    color: \"textSecondary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, \"OR\")), React.createElement(\"div\", {\n    className: classes.orLine,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  })), React.createElement(LoginWithFacebook, {\n    color: \"secondary\",\n    iconColor: \"blue\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }), React.createElement(AuthError, {\n    error: error,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }), React.createElement(Button, {\n    fullWidth: true,\n    color: \"secondary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, React.createElement(Typography, {\n    variant: \"caption\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"Forgor Password?\"))), React.createElement(Card, {\n    className: classes.signUpCard,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, React.createElement(Typography, {\n    align: \"right\",\n    variant: \"body2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }, \"Don't have an account?\"), React.createElement(Link, {\n    to: \"/accounts/emailsignup\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, React.createElement(Button, {\n    color: \"primary\",\n    className: classes.button,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    },\n    __self: this\n  }, \"Sign up\"))))));\n};\n\nexport const LoginWithFacebook = ({\n  color,\n  iconColor,\n  variant\n}) => {\n  const classes = useLoginPageStyles();\n  const {\n    logInWithGoogle\n  } = React.useContext(AuthContext);\n  const facebookIcon = iconColor === \"blue\" ? FacebookIconBlue : FacebookIconWhite;\n  const [error, setError] = React.useState('');\n  const history = useHistory();\n\n  const handleLogInWithGoogle = async () => {\n    try {\n      await logInWithGoogle();\n      setTimeout(history.push('/'), 0);\n    } catch (error) {\n      console.error('Error logging in with Google', error);\n      setError(error.message);\n    }\n  };\n\n  return React.createElement(React.Fragment, null, React.createElement(Button, {\n    onClick: handleLogInWithGoogle,\n    fullWidth: true,\n    color: color,\n    variant: variant,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: facebookIcon,\n    alt: \"facebook icon\",\n    className: classes.facebookIcon,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }), \"Log In With Facebook\"), React.createElement(AuthError, {\n    error: error,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214\n    },\n    __self: this\n  }));\n};\nexport default LoginPage;","map":{"version":3,"sources":["/Users/jia78/Desktop/nyu-mscs/9223-cloud-computing/cloud-computing-proj/cloud-computing-proj/src/pages/login.js"],"names":["Button","Card","CardHeader","TextField","Typography","InputAdornment","React","Link","SEO","useLoginPageStyles","FacebookIconWhite","useForm","Controller","AuthContext","useHistory","isEmail","useApolloClient","GET_USER_EMAIL","AuthError","LoginPage","handleSubmit","watch","formState","control","mode","isValid","isSubmitting","classes","showPassword","setShowPassword","useState","hasPassword","Boolean","logInWithEmailAndPassword","useContext","history","client","error","setError","console","log","handleClickShowPassword","event","prev","getUserEmail","input","variables","response","query","userEmail","data","users","email","handleError","code","includes","message","onSubmit","password","setTimeout","push","section","card","cardHeader","field","onChange","value","fieldState","textField","minLength","endAdornment","adornedEndButton","adornedEnd","button","orContainer","orLine","signUpCard","LoginWithFacebook","color","iconColor","variant","logInWithGoogle","facebookIcon","FacebookIconBlue","handleLogInWithGoogle"],"mappings":"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","sourcesContent":["import {\n  Button,\n  Card,\n  CardHeader,\n  TextField,\n  Typography,\n  InputAdornment,\n} from \"@material-ui/core\";\nimport React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport SEO from \"../components/shared/Seo\";\nimport { useLoginPageStyles } from \"../styles\";\nimport FacebookIconBlue from \"../images/facebook-icon-blue.svg\";\nimport FacebookIconWhite from \"../images/facebook-icon-white.png\";\nimport { useForm, Controller } from \"react-hook-form\";\nimport { AuthContext } from \"../auth\";\nimport { useHistory } from 'react-router-dom';\nimport isEmail from \"validator/lib/isEmail\";\nimport { useApolloClient } from \"@apollo/client\";\nimport { GET_USER_EMAIL } from \"../graphql/queries\";\nimport { AuthError } from './signup';\n\nconst LoginPage = () => {\n  const { handleSubmit, watch, formState, control } = useForm({\n    mode: \"onChange\",\n  });\n  const { isValid, isSubmitting } = formState;\n  const classes = useLoginPageStyles();\n  const [showPassword, setShowPassword] = React.useState(false);\n  const hasPassword = Boolean(watch(\"password\"))\n  const { logInWithEmailAndPassword } = React.useContext(AuthContext);\n  const history = useHistory();\n  const client = useApolloClient()\n  const [error, setError] = React.useState('')\n  console.log()\n\n  const handleClickShowPassword = (event) => {\n    setShowPassword(prev => !prev)\n  }\n  async function getUserEmail(input) {\n    const variables = { input };\n    console.log(variables);\n    const response = await client.query({\n      query: GET_USER_EMAIL,\n      variables,\n    });\n    const userEmail = response.data.users[0]?.email || \"no@email.com\";\n    console.log('user email', userEmail);\n    return userEmail;\n  }\n\n  const handleError = (error) => {\n    if (error.code.includes(\"auth\")) {\n      setError(error.message);\n    }\n  }\n\n  async function onSubmit({ input, password }) {\n    try {\n      setError(\"\");\n      if (!isEmail(input)) {\n        input = await getUserEmail(input);\n      }\n      console.log({ input, password });\n      await logInWithEmailAndPassword(input, password);\n      setTimeout(() => history.push(\"/\"), 0);\n    } catch (error) {\n      console.error(\"Error logging in\", error);\n      handleError(error);\n    }\n  }\n  // const handleMouseDownPassword = () => setShowPassword(!showPassword)\n\n  return (\n    <>\n      <SEO title=\"Login\" />\n      <section className={classes.section}>\n        <article>\n          <Card className={classes.card}>\n            <CardHeader className={classes.cardHeader} />\n            <form onSubmit={handleSubmit(onSubmit)}>\n              <Controller\n                name=\"input\"\n                control={control}\n                defaultValue=\"\"\n                render={({ field: { onChange, value }, fieldState: { error } }) => (\n                  <TextField\n                    // {...register('input', { 'required': true, minLength: 5 })}\n                    fullWidth\n                    variant=\"filled\"\n                    label=\"Username, email or phone\"\n                    margin=\"dense\"\n                    className={classes.textField}\n                    // autoComplete=\"username\"\n                    error={!!error}\n                    value={value}\n                    onChange={onChange}\n                    helperText={error ? error.message : null}\n                  />\n                )}\n                rules={{ 'required': true, minLength: 5 }}\n              />\n              <Controller\n                name=\"password\"\n                control={control}\n                defaultValue=\"\"\n                render={({ field: { onChange, value }, fieldState: { error } }) => (\n                  <TextField\n                    // {...register('password', { 'required': true, minLength: 6 })}\n                    fullWidth\n                    variant=\"filled\"\n                    label=\"password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    margin=\"dense\"\n                    className={classes.textField}\n                    // autoComplete=\"current-password\"\n                    value={value}\n                    onChange={onChange}\n                    error={!!error}\n                    helperText={error ? error.message : null}\n                    InputProps={{\n                      endAdornment: hasPassword && (\n                        <InputAdornment position=\"end\">\n                          <Button\n                            variant=\"contained\"\n                            fullWidth\n                            className={classes.adornedEndButton}\n                            onClick={handleClickShowPassword}\n                          >\n                            {showPassword ? \"Hide\" : \"Show\"}\n                          </Button>\n\n                        </InputAdornment>\n                      ),\n                      classes: {\n                        adornedEnd: classes.adornedEnd\n                      }\n                    }}\n                  />\n                )}\n                rules={{ 'required': true, minLength: 6 }}\n              />\n\n              <Button\n                disabled={!isValid || isSubmitting}\n                variant=\"contained\"\n                fullWidth\n                color=\"primary\"\n                className={classes.button}\n                type=\"submit\"\n              >\n                Log In\n              </Button>\n            </form>\n            <div className={classes.orContainer}>\n              <div className={classes.orLine} />\n              <div>\n                <Typography variant=\"body2\" color=\"textSecondary\">\n                  OR\n                </Typography>\n              </div>\n              <div className={classes.orLine} />\n            </div>\n            <LoginWithFacebook color=\"secondary\" iconColor=\"blue\" />\n            <AuthError error={error} />\n            <Button fullWidth color=\"secondary\">\n              <Typography variant=\"caption\">\n                Forgor Password?\n              </Typography>\n            </Button>\n          </Card>\n          <Card className={classes.signUpCard}>\n            <Typography align=\"right\" variant=\"body2\">\n              Don't have an account?\n            </Typography>\n            <Link to=\"/accounts/emailsignup\">\n              <Button color=\"primary\" className={classes.button}>\n                Sign up\n              </Button>\n            </Link>\n          </Card>\n        </article>\n      </section>\n    </>\n  )\n}\n\nexport const LoginWithFacebook = ({ color, iconColor, variant }) => {\n  const classes = useLoginPageStyles();\n  const { logInWithGoogle } = React.useContext(AuthContext)\n  const facebookIcon = iconColor === \"blue\" ? FacebookIconBlue : FacebookIconWhite;\n  const [error, setError] = React.useState('')\n  const history = useHistory();\n\n  const handleLogInWithGoogle = async () => {\n    try {\n      await logInWithGoogle();\n      setTimeout(history.push('/'), 0);\n    } catch (error) {\n      console.error('Error logging in with Google', error)\n      setError(error.message)\n    }\n  }\n  return (\n    <>\n      <Button onClick={handleLogInWithGoogle} fullWidth color={color} variant={variant}>\n        <img\n          src={facebookIcon}\n          alt=\"facebook icon\"\n          className={classes.facebookIcon}\n        />\n        Log In With Facebook\n      </Button>\n      <AuthError error={error} />\n    </>\n  )\n}\n\nexport default LoginPage;\n\n"]},"metadata":{},"sourceType":"module"}